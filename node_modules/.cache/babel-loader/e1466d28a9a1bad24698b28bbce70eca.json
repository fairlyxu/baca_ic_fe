{"remainingRequest":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/node_modules/babel-loader/lib/index.js!/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/src/utils/login_hooks.js","dependencies":[{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/src/utils/login_hooks.js","mtime":1641637099301},{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/babel.config.js","mtime":1640424508700},{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/node_modules/cache-loader/dist/cjs.js","mtime":1641628857414},{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/node_modules/babel-loader/lib/index.js","mtime":1641628857287}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9mYWlybHl4dS9Eb2N1bWVudHMvMDgtd29ya3NwYWNlLzA3LXdlYjMvYmFjYWxhYi9iYWNhX2FwcF9oNS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKCi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovCi8vIGltcG9ydCB7IEFjdG9yU3ViY2xhc3MsIElkZW50aXR5IH0gZnJvbSAiQGRmaW5pdHkvYWdlbnQiOwppbXBvcnQgeyBBdXRoQ2xpZW50IH0gZnJvbSAiQGRmaW5pdHkvYXV0aC1jbGllbnQiOwppbXBvcnQgeyBjbGVhciB9IGZyb20gImxvY2FsLXN0b3JhZ2UiOyAvL2ltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICJyZWFjdCI7IAoKaW1wb3J0IHsgY3JlYXRlQWN0b3IgYXMgZGlwMjBDcmVhdGVBY3RvciwgY2FuaXN0ZXJJZCBhcyBkaXAyMENhbmlzdGVySWQgfSBmcm9tICIuL2RpcDIwL2luZGV4IjsKZXhwb3J0IGZ1bmN0aW9uIHVzZUF1dGhDbGllbnQocHJvcHMpIHsKICB2YXIgYXV0aENsaWVudCA9IG51bGw7CiAgdmFyIG15YWN0b3IgPSBudWxsOwogIHZhciBpc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTsKICB2YXIgcHJpbmNpcGFsID0gZmFsc2U7IC8vY29uc3QgW2F1dGhDbGllbnQsIHNldEF1dGhDbGllbnRdID0gdXNlU3RhdGUobnVsbCk7CiAgLy9jb25zdCBbYWN0b3IsIHNldEFjdG9yXSA9IHVzZVN0YXRlKG51bGwpOwogIC8vY29uc3QgW2lzQXV0aGVudGljYXRlZCwgc2V0SXNBdXRoZW50aWNhdGVkXSA9IHVzZVN0YXRlKGZhbHNlKTsKICAvL2NvbnN0IFtwcmluY2lwYWwsIHNldFByaW5jaXBhbF0gPSB1c2VTdGF0ZShmYWxzZSk7CgogIHZhciBkYXlzID0gQmlnSW50KDEpOwogIHZhciBob3VycyA9IEJpZ0ludCgyNCk7CiAgdmFyIG5hbm9zZWNvbmRzID0gQmlnSW50KDM2MDAwMDAwMDAwMDApOwoKICB2YXIgbG9naW4gPSBmdW5jdGlvbiBsb2dpbigpIHsKICAgIHZhciBfYXV0aENsaWVudDsKCiAgICAoX2F1dGhDbGllbnQgPSBhdXRoQ2xpZW50KSA9PT0gbnVsbCB8fCBfYXV0aENsaWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2F1dGhDbGllbnQubG9naW4oewogICAgICBpZGVudGl0eVByb3ZpZGVyOiBwcm9jZXNzLmVudi5ERlhfTkVUV09SSyA9PT0gImljIiA/ICJodHRwczovL2lkZW50aXR5LmljMC5hcHAvI2F1dGhvcml6ZSIgOiBwcm9jZXNzLmVudi5MT0NBTF9JSV9DQU5JU1RFUiwKICAgICAgLy8gaWRlbnRpdHlQcm92aWRlcjogImh0dHBzOi8vaWRlbnRpdHkuaWMwLmFwcC8jYXV0aG9yaXplIiwKICAgICAgb25TdWNjZXNzOiBmdW5jdGlvbiBvblN1Y2Nlc3MoKSB7CiAgICAgICAgaW5pdEFjdG9yKCk7CiAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTsgLy9zZXRJc0F1dGhlbnRpY2F0ZWQodHJ1ZSk7CiAgICAgIH0sCiAgICAgIG1heFRpbWVUb0xpdmU6IGRheXMgKiBob3VycyAqIG5hbm9zZWNvbmRzCiAgICB9KTsKICB9OwoKICB2YXIgaW5pdEFjdG9yID0gZnVuY3Rpb24gaW5pdEFjdG9yKCkgewogICAgdmFyIF9hdXRoQ2xpZW50MjsKCiAgICB2YXIgYWN0b3IgPSBkaXAyMENyZWF0ZUFjdG9yKGRpcDIwQ2FuaXN0ZXJJZCwgewogICAgICBhZ2VudE9wdGlvbnM6IHsKICAgICAgICBpZGVudGl0eTogKF9hdXRoQ2xpZW50MiA9IGF1dGhDbGllbnQpID09PSBudWxsIHx8IF9hdXRoQ2xpZW50MiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2F1dGhDbGllbnQyLmdldElkZW50aXR5KCkKICAgICAgfQogICAgfSk7CiAgICBteWFjdG9yID0gYWN0b3I7IC8vc2V0QWN0b3IoYWN0b3IpOwogIH07CgogIHZhciBsb2dvdXQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHZhciBfYXV0aENsaWVudDM7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgY2xlYXIoKTsKICAgICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTsgLy9zZXRJc0F1dGhlbnRpY2F0ZWQoZmFsc2UpOwoKICAgICAgICAgICAgICBteWFjdG9yID0gdW5kZWZpbmVkOyAvL3NldEFjdG9yKHVuZGVmaW5lZCk7CgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiAoX2F1dGhDbGllbnQzID0gYXV0aENsaWVudCkgPT09IG51bGwgfHwgX2F1dGhDbGllbnQzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYXV0aENsaWVudDMubG9nb3V0KCk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY29uc29sZS5hbGVydCgiWW91IGhhdmUgbG9nZ2VkIG91dCEiKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIGxvZ291dCgpIHsKICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpOwoKICBBdXRoQ2xpZW50LmNyZWF0ZSgpLnRoZW4oIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGNsaWVudDEpIHsKICAgICAgdmFyIGlzQXV0aGVudGljYXRlZDE7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiBjbGllbnQxLmlzQXV0aGVudGljYXRlZCgpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDEgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICBhdXRoQ2xpZW50ID0gY2xpZW50MTsKICAgICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQgPSBpc0F1dGhlbnRpY2F0ZWQxOwogICAgICAgICAgICAgIHByaW5jaXBhbCA9IGNsaWVudDEuZ2V0SWRlbnRpdHkoKS5nZXRQcmluY2lwYWwoKS50b1RleHQoKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCkpOwogIGlmIChpc0F1dGhlbnRpY2F0ZWQpIGluaXRBY3RvcigpOwogIHJldHVybiB7CiAgICBhdXRoQ2xpZW50OiBhdXRoQ2xpZW50LAogICAgaXNBdXRoZW50aWNhdGVkOiBpc0F1dGhlbnRpY2F0ZWQsCiAgICBsb2dpbjogbG9naW4sCiAgICBsb2dvdXQ6IGxvZ291dCwKICAgIG15YWN0b3I6IG15YWN0b3IsCiAgICBwcmluY2lwYWw6IHByaW5jaXBhbAogIH07Cn0="},{"version":3,"sources":["/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/src/utils/login_hooks.js"],"names":["AuthClient","clear","createActor","dip20CreateActor","canisterId","dip20CanisterId","useAuthClient","props","authClient","myactor","isAuthenticated","principal","days","BigInt","hours","nanoseconds","login","identityProvider","process","env","DFX_NETWORK","LOCAL_II_CANISTER","onSuccess","initActor","maxTimeToLive","actor","agentOptions","identity","getIdentity","logout","undefined","console","alert","create","then","client1","isAuthenticated1","getPrincipal","toText"],"mappings":";;;AAAA;AACA;AACA,SAASA,UAAT,QAA2B,sBAA3B;AACA,SAASC,KAAT,QAAsB,eAAtB,C,CACA;;AACA,SAASC,WAAW,IAAIC,gBAAxB,EAA0CC,UAAU,IAAIC,eAAxD,QAA+E,eAA/E;AAGA,OAAO,SAASC,aAAT,CAAwBC,KAAxB,EAA+B;AACpC,MAAIC,UAAU,GAAG,IAAjB;AACA,MAAIC,OAAO,GAAG,IAAd;AACA,MAAIC,eAAe,GAAG,KAAtB;AACA,MAAIC,SAAS,GAAG,KAAhB,CAJoC,CAMpC;AACA;AACA;AACA;;AAEA,MAAMC,IAAI,GAAGC,MAAM,CAAC,CAAD,CAAnB;AACA,MAAMC,KAAK,GAAGD,MAAM,CAAC,EAAD,CAApB;AACA,MAAME,WAAW,GAAGF,MAAM,CAAC,aAAD,CAA1B;;AAEA,MAAMG,KAAK,GAAG,SAARA,KAAQ,GAAM;AAAA;;AAClB,mBAAAR,UAAU,UAAV,kDAAYQ,KAAZ,CAAkB;AAChBC,MAAAA,gBAAgB,EAAEC,OAAO,CAACC,GAAR,CAAYC,WAAZ,KAA4B,IAA5B,GACd,qCADc,GAEdF,OAAO,CAACC,GAAR,CAAYE,iBAHA;AAIhB;AACAC,MAAAA,SAAS,EAAE,qBAAM;AACfC,QAAAA,SAAS;AACTb,QAAAA,eAAe,GAAG,IAAlB,CAFe,CAGf;AACD,OATe;AAUhBc,MAAAA,aAAa,EAAEZ,IAAI,GAAGE,KAAP,GAAeC;AAVd,KAAlB;AAYD,GAbD;;AAeA,MAAMQ,SAAS,GAAG,SAAZA,SAAY,GAAM;AAAA;;AACtB,QAAME,KAAK,GAAGtB,gBAAgB,CAACE,eAAD,EAAkB;AAC9CqB,MAAAA,YAAY,EAAE;AACZC,QAAAA,QAAQ,kBAAEnB,UAAF,iDAAE,aAAYoB,WAAZ;AADE;AADgC,KAAlB,CAA9B;AAKAnB,IAAAA,OAAO,GAAGgB,KAAV,CANsB,CAOtB;AACD,GARD;;AAUA,MAAMI,MAAM;AAAA,uEAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AACb5B,cAAAA,KAAK;AACLS,cAAAA,eAAe,GAAG,KAAlB,CAFa,CAGb;;AACAD,cAAAA,OAAO,GAAGqB,SAAV,CAJa,CAKb;;AALa;AAAA,qCAMPtB,UANO,iDAMP,aAAYqB,MAAZ,EANO;;AAAA;AAObE,cAAAA,OAAO,CAACC,KAAR,CAAc,sBAAd;;AAPa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAANH,MAAM;AAAA;AAAA;AAAA,KAAZ;;AAUA7B,EAAAA,UAAU,CAACiC,MAAX,GAAoBC,IAApB;AAAA,wEAAyB,kBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACQA,OAAO,CAACzB,eAAR,EADR;;AAAA;AACjB0B,cAAAA,gBADiB;AAEvB5B,cAAAA,UAAU,GAAG2B,OAAb;AACAzB,cAAAA,eAAe,GAAG0B,gBAAlB;AACAzB,cAAAA,SAAS,GAAGwB,OAAO,CAACP,WAAR,GAAsBS,YAAtB,GAAqCC,MAArC,EAAZ;;AAJuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAzB;;AAAA;AAAA;AAAA;AAAA;AAQA,MAAI5B,eAAJ,EAAqBa,SAAS;AAE9B,SAAO;AACLf,IAAAA,UAAU,EAAVA,UADK;AAELE,IAAAA,eAAe,EAAfA,eAFK;AAGLM,IAAAA,KAAK,EAALA,KAHK;AAILa,IAAAA,MAAM,EAANA,MAJK;AAKLpB,IAAAA,OAAO,EAAPA,OALK;AAMLE,IAAAA,SAAS,EAATA;AANK,GAAP;AAQD","sourcesContent":["/* eslint-disable no-undef */\n// import { ActorSubclass, Identity } from \"@dfinity/agent\";\nimport { AuthClient } from \"@dfinity/auth-client\";\nimport { clear } from \"local-storage\";\n//import { useState, useEffect } from \"react\"; \nimport { createActor as dip20CreateActor, canisterId as dip20CanisterId } from \"./dip20/index\";\n \n\nexport function useAuthClient (props) {\n  var authClient = null;\n  var myactor = null;\n  var isAuthenticated = false;\n  var principal = false;\n\n  //const [authClient, setAuthClient] = useState(null);\n  //const [actor, setActor] = useState(null);\n  //const [isAuthenticated, setIsAuthenticated] = useState(false);\n  //const [principal, setPrincipal] = useState(false);\n\n  const days = BigInt(1);\n  const hours = BigInt(24);\n  const nanoseconds = BigInt(3600000000000);\n\n  const login = () => {\n    authClient?.login({\n      identityProvider: process.env.DFX_NETWORK === \"ic\"\n        ? \"https://identity.ic0.app/#authorize\"\n        : process.env.LOCAL_II_CANISTER,\n      // identityProvider: \"https://identity.ic0.app/#authorize\",\n      onSuccess: () => {\n        initActor();\n        isAuthenticated = true;\n        //setIsAuthenticated(true);\n      },\n      maxTimeToLive: days * hours * nanoseconds,\n    });\n  };\n\n  const initActor = () => {\n    const actor = dip20CreateActor(dip20CanisterId, {\n      agentOptions: {\n        identity: authClient?.getIdentity(),\n      },\n    });\n    myactor = actor;\n    //setActor(actor);\n  };\n\n  const logout = async () => {\n    clear();\n    isAuthenticated = false;\n    //setIsAuthenticated(false);\n    myactor = undefined\n    //setActor(undefined);\n    await authClient?.logout();\n    console.alert(\"You have logged out!\");\n  };\n\n  AuthClient.create().then(async (client1) => {\n    const isAuthenticated1 = await client1.isAuthenticated();\n    authClient = client1;\n    isAuthenticated = isAuthenticated1;\n    principal = client1.getIdentity().getPrincipal().toText()\n\n  })\n\n  if (isAuthenticated) initActor();\n\n  return {\n    authClient,\n    isAuthenticated,\n    login,\n    logout,\n    myactor,\n    principal,\n  };\n}\n\n\n\n"]}]}