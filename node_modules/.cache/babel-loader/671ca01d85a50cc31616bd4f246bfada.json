{"remainingRequest":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/node_modules/babel-loader/lib/index.js!/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/src/utils/login_hooks.js","dependencies":[{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/src/utils/login_hooks.js","mtime":1641637528841},{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/babel.config.js","mtime":1640424508700},{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/node_modules/cache-loader/dist/cjs.js","mtime":1641628857414},{"path":"/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/node_modules/babel-loader/lib/index.js","mtime":1641628857287}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9mYWlybHl4dS9Eb2N1bWVudHMvMDgtd29ya3NwYWNlLzA3LXdlYjMvYmFjYWxhYi9iYWNhX2FwcF9oNS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKCi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovCmltcG9ydCB7IEFjdG9yU3ViY2xhc3MsIElkZW50aXR5IH0gZnJvbSAiQGRmaW5pdHkvYWdlbnQiOwppbXBvcnQgeyBBdXRoQ2xpZW50IH0gZnJvbSAiQGRmaW5pdHkvYXV0aC1jbGllbnQiOwppbXBvcnQgeyBjbGVhciB9IGZyb20gImxvY2FsLXN0b3JhZ2UiOwppbXBvcnQgeyBjcmVhdGVBY3RvciBhcyBkaXAyMENyZWF0ZUFjdG9yLCBjYW5pc3RlcklkIGFzIGRpcDIwQ2FuaXN0ZXJJZCB9IGZyb20gImRpcDIwIjsKZXhwb3J0IGZ1bmN0aW9uIHVzZUF1dGhDbGllbnQoKSB7CiAgdmFyIGF1dGhDbGllbnQgPSBudWxsOwogIHZhciBteWFjdG9yID0gbnVsbDsKICB2YXIgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7CiAgdmFyIHByaW5jaXBhbCA9IGZhbHNlOyAvL2NvbnN0IFthdXRoQ2xpZW50LCBzZXRBdXRoQ2xpZW50XSA9IHVzZVN0YXRlKG51bGwpOwogIC8vY29uc3QgW2FjdG9yLCBzZXRBY3Rvcl0gPSB1c2VTdGF0ZShudWxsKTsKICAvL2NvbnN0IFtpc0F1dGhlbnRpY2F0ZWQsIHNldElzQXV0aGVudGljYXRlZF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgLy9jb25zdCBbcHJpbmNpcGFsLCBzZXRQcmluY2lwYWxdID0gdXNlU3RhdGUoZmFsc2UpOwoKICB2YXIgZGF5cyA9IEJpZ0ludCgxKTsKICB2YXIgaG91cnMgPSBCaWdJbnQoMjQpOwogIHZhciBuYW5vc2Vjb25kcyA9IEJpZ0ludCgzNjAwMDAwMDAwMDAwKTsKCiAgdmFyIGxvZ2luID0gZnVuY3Rpb24gbG9naW4oKSB7CiAgICB2YXIgX2F1dGhDbGllbnQ7CgogICAgKF9hdXRoQ2xpZW50ID0gYXV0aENsaWVudCkgPT09IG51bGwgfHwgX2F1dGhDbGllbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hdXRoQ2xpZW50LmxvZ2luKHsKICAgICAgaWRlbnRpdHlQcm92aWRlcjogcHJvY2Vzcy5lbnYuREZYX05FVFdPUksgPT09ICJpYyIgPyAiaHR0cHM6Ly9pZGVudGl0eS5pYzAuYXBwLyNhdXRob3JpemUiIDogcHJvY2Vzcy5lbnYuTE9DQUxfSUlfQ0FOSVNURVIsCiAgICAgIC8vIGlkZW50aXR5UHJvdmlkZXI6ICJodHRwczovL2lkZW50aXR5LmljMC5hcHAvI2F1dGhvcml6ZSIsCiAgICAgIG9uU3VjY2VzczogZnVuY3Rpb24gb25TdWNjZXNzKCkgewogICAgICAgIGluaXRBY3RvcigpOwogICAgICAgIGlzQXV0aGVudGljYXRlZCA9IHRydWU7IC8vc2V0SXNBdXRoZW50aWNhdGVkKHRydWUpOwogICAgICB9LAogICAgICBtYXhUaW1lVG9MaXZlOiBkYXlzICogaG91cnMgKiBuYW5vc2Vjb25kcwogICAgfSk7CiAgfTsKCiAgdmFyIGluaXRBY3RvciA9IGZ1bmN0aW9uIGluaXRBY3RvcigpIHsKICAgIHZhciBfYXV0aENsaWVudDI7CgogICAgdmFyIGFjdG9yID0gZGlwMjBDcmVhdGVBY3RvcihkaXAyMENhbmlzdGVySWQsIHsKICAgICAgYWdlbnRPcHRpb25zOiB7CiAgICAgICAgaWRlbnRpdHk6IChfYXV0aENsaWVudDIgPSBhdXRoQ2xpZW50KSA9PT0gbnVsbCB8fCBfYXV0aENsaWVudDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hdXRoQ2xpZW50Mi5nZXRJZGVudGl0eSgpCiAgICAgIH0KICAgIH0pOwogICAgbXlhY3RvciA9IGFjdG9yOyAvL3NldEFjdG9yKGFjdG9yKTsKICB9OwoKICB2YXIgbG9nb3V0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgX2F1dGhDbGllbnQzOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGNsZWFyKCk7CiAgICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gZmFsc2U7IC8vc2V0SXNBdXRoZW50aWNhdGVkKGZhbHNlKTsKCiAgICAgICAgICAgICAgbXlhY3RvciA9IHVuZGVmaW5lZDsgLy9zZXRBY3Rvcih1bmRlZmluZWQpOwoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gKF9hdXRoQ2xpZW50MyA9IGF1dGhDbGllbnQpID09PSBudWxsIHx8IF9hdXRoQ2xpZW50MyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2F1dGhDbGllbnQzLmxvZ291dCgpOwoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNvbnNvbGUuYWxlcnQoIllvdSBoYXZlIGxvZ2dlZCBvdXQhIik7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiBsb2dvdXQoKSB7CiAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKTsKCiAgQXV0aENsaWVudC5jcmVhdGUoKS50aGVuKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihjbGllbnQxKSB7CiAgICAgIHZhciBpc0F1dGhlbnRpY2F0ZWQxOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gY2xpZW50MS5pc0F1dGhlbnRpY2F0ZWQoKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQxID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgYXV0aENsaWVudCA9IGNsaWVudDE7CiAgICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkID0gaXNBdXRoZW50aWNhdGVkMTsKICAgICAgICAgICAgICBwcmluY2lwYWwgPSBjbGllbnQxLmdldElkZW50aXR5KCkuZ2V0UHJpbmNpcGFsKCkudG9UZXh0KCk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMik7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKICBpZiAoaXNBdXRoZW50aWNhdGVkKSBpbml0QWN0b3IoKTsKICByZXR1cm4gewogICAgYXV0aENsaWVudDogYXV0aENsaWVudCwKICAgIGlzQXV0aGVudGljYXRlZDogaXNBdXRoZW50aWNhdGVkLAogICAgbG9naW46IGxvZ2luLAogICAgbG9nb3V0OiBsb2dvdXQsCiAgICBteWFjdG9yOiBteWFjdG9yLAogICAgcHJpbmNpcGFsOiBwcmluY2lwYWwKICB9Owp9"},{"version":3,"sources":["/Users/fairlyxu/Documents/08-workspace/07-web3/bacalab/baca_app_h5/src/utils/login_hooks.js"],"names":["ActorSubclass","Identity","AuthClient","clear","createActor","dip20CreateActor","canisterId","dip20CanisterId","useAuthClient","authClient","myactor","isAuthenticated","principal","days","BigInt","hours","nanoseconds","login","identityProvider","process","env","DFX_NETWORK","LOCAL_II_CANISTER","onSuccess","initActor","maxTimeToLive","actor","agentOptions","identity","getIdentity","logout","undefined","console","alert","create","then","client1","isAuthenticated1","getPrincipal","toText"],"mappings":";;;AAAA;AACA,SAASA,aAAT,EAAwBC,QAAxB,QAAwC,gBAAxC;AACA,SAASC,UAAT,QAA2B,sBAA3B;AACA,SAASC,KAAT,QAAsB,eAAtB;AACA,SAASC,WAAW,IAAIC,gBAAxB,EAA0CC,UAAU,IAAIC,eAAxD,QAA+E,OAA/E;AAGA,OAAO,SAASC,aAAT,GAA0B;AAC/B,MAAIC,UAAU,GAAG,IAAjB;AACA,MAAIC,OAAO,GAAG,IAAd;AACA,MAAIC,eAAe,GAAG,KAAtB;AACA,MAAIC,SAAS,GAAG,KAAhB,CAJ+B,CAM/B;AACA;AACA;AACA;;AAEA,MAAMC,IAAI,GAAGC,MAAM,CAAC,CAAD,CAAnB;AACA,MAAMC,KAAK,GAAGD,MAAM,CAAC,EAAD,CAApB;AACA,MAAME,WAAW,GAAGF,MAAM,CAAC,aAAD,CAA1B;;AAEA,MAAMG,KAAK,GAAG,SAARA,KAAQ,GAAM;AAAA;;AAClB,mBAAAR,UAAU,UAAV,kDAAYQ,KAAZ,CAAkB;AAChBC,MAAAA,gBAAgB,EAAEC,OAAO,CAACC,GAAR,CAAYC,WAAZ,KAA4B,IAA5B,GACd,qCADc,GAEdF,OAAO,CAACC,GAAR,CAAYE,iBAHA;AAIhB;AACAC,MAAAA,SAAS,EAAE,qBAAM;AACfC,QAAAA,SAAS;AACTb,QAAAA,eAAe,GAAG,IAAlB,CAFe,CAGf;AACD,OATe;AAUhBc,MAAAA,aAAa,EAAEZ,IAAI,GAAGE,KAAP,GAAeC;AAVd,KAAlB;AAYD,GAbD;;AAeA,MAAMQ,SAAS,GAAG,SAAZA,SAAY,GAAM;AAAA;;AACtB,QAAME,KAAK,GAAGrB,gBAAgB,CAACE,eAAD,EAAkB;AAC9CoB,MAAAA,YAAY,EAAE;AACZC,QAAAA,QAAQ,kBAAEnB,UAAF,iDAAE,aAAYoB,WAAZ;AADE;AADgC,KAAlB,CAA9B;AAKAnB,IAAAA,OAAO,GAAGgB,KAAV,CANsB,CAOtB;AACD,GARD;;AAUA,MAAMI,MAAM;AAAA,uEAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AACb3B,cAAAA,KAAK;AACLQ,cAAAA,eAAe,GAAG,KAAlB,CAFa,CAGb;;AACAD,cAAAA,OAAO,GAAGqB,SAAV,CAJa,CAKb;;AALa;AAAA,qCAMPtB,UANO,iDAMP,aAAYqB,MAAZ,EANO;;AAAA;AAObE,cAAAA,OAAO,CAACC,KAAR,CAAc,sBAAd;;AAPa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAANH,MAAM;AAAA;AAAA;AAAA,KAAZ;;AAUA5B,EAAAA,UAAU,CAACgC,MAAX,GAAoBC,IAApB;AAAA,wEAAyB,kBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACQA,OAAO,CAACzB,eAAR,EADR;;AAAA;AACjB0B,cAAAA,gBADiB;AAEvB5B,cAAAA,UAAU,GAAG2B,OAAb;AACAzB,cAAAA,eAAe,GAAG0B,gBAAlB;AACAzB,cAAAA,SAAS,GAAGwB,OAAO,CAACP,WAAR,GAAsBS,YAAtB,GAAqCC,MAArC,EAAZ;;AAJuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAzB;;AAAA;AAAA;AAAA;AAAA;AAQA,MAAI5B,eAAJ,EAAqBa,SAAS;AAE9B,SAAO;AACLf,IAAAA,UAAU,EAAVA,UADK;AAELE,IAAAA,eAAe,EAAfA,eAFK;AAGLM,IAAAA,KAAK,EAALA,KAHK;AAILa,IAAAA,MAAM,EAANA,MAJK;AAKLpB,IAAAA,OAAO,EAAPA,OALK;AAMLE,IAAAA,SAAS,EAATA;AANK,GAAP;AAQD","sourcesContent":["/* eslint-disable no-undef */\nimport { ActorSubclass, Identity } from \"@dfinity/agent\";\nimport { AuthClient } from \"@dfinity/auth-client\";\nimport { clear } from \"local-storage\"; \nimport { createActor as dip20CreateActor, canisterId as dip20CanisterId } from \"dip20\";\n \n\nexport function useAuthClient () {\n  var authClient = null;\n  var myactor = null;\n  var isAuthenticated = false;\n  var principal = false;\n\n  //const [authClient, setAuthClient] = useState(null);\n  //const [actor, setActor] = useState(null);\n  //const [isAuthenticated, setIsAuthenticated] = useState(false);\n  //const [principal, setPrincipal] = useState(false);\n\n  const days = BigInt(1);\n  const hours = BigInt(24);\n  const nanoseconds = BigInt(3600000000000);\n\n  const login = () => {\n    authClient?.login({\n      identityProvider: process.env.DFX_NETWORK === \"ic\"\n        ? \"https://identity.ic0.app/#authorize\"\n        : process.env.LOCAL_II_CANISTER,\n      // identityProvider: \"https://identity.ic0.app/#authorize\",\n      onSuccess: () => {\n        initActor();\n        isAuthenticated = true;\n        //setIsAuthenticated(true);\n      },\n      maxTimeToLive: days * hours * nanoseconds,\n    });\n  };\n\n  const initActor = () => {\n    const actor = dip20CreateActor(dip20CanisterId, {\n      agentOptions: {\n        identity: authClient?.getIdentity(),\n      },\n    });\n    myactor = actor;\n    //setActor(actor);\n  };\n\n  const logout = async () => {\n    clear();\n    isAuthenticated = false;\n    //setIsAuthenticated(false);\n    myactor = undefined\n    //setActor(undefined);\n    await authClient?.logout();\n    console.alert(\"You have logged out!\");\n  };\n\n  AuthClient.create().then(async (client1) => {\n    const isAuthenticated1 = await client1.isAuthenticated();\n    authClient = client1;\n    isAuthenticated = isAuthenticated1;\n    principal = client1.getIdentity().getPrincipal().toText()\n\n  })\n\n  if (isAuthenticated) initActor();\n\n  return {\n    authClient,\n    isAuthenticated,\n    login,\n    logout,\n    myactor,\n    principal,\n  };\n}\n\n\n\n"]}]}